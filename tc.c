#include "tc.h"						//we use thermocouple library

//thermocoupler coefficients
//array split to reduce size
const TCCOEF_TYPEDEF TCB_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
    //type b
    {0.291, 		2.431, 			{9.8423321E+01,	 	6.9971500E+02,		-8.4765304E+02,		1.0052644E+03,  	-8.3345952E+02, 	4.5508542E+02,  	-1.5523037E+02, 	2.9886750E+01, 		-2.4742860E+00,		0.00}},   			//TC_CURVE_B1, Type B, 250 - 700c
    {2.431,			13.820,			{2.1315071E+02,	 	2.8510504E+02,		-5.2742887E+01,	 	9.9160804E+00,  	-1.2965303E+00, 	1.1195870E-01,  	-6.0625199E-03,  	1.8661696E-04 ,		-2.4878585E-06,		0.00}} 				//TC_CURVE_B2, Type B, 700 - 1800c
};

const TCCOEF_TYPEDEF TCE_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
    //type e
    {-8.825,		0.000,			{0.0000000E+00,		1.6977288E+01,		-4.3514970E-01,	 	-1.5859697E-01,		-9.2502871E-02,		-2.6084314E-02,		-4.1360199E-03,		-3.4034030E-04,		-1.1564890E-05,		0.0000000E+00}},	//TC_CURVE_E1, -200 - 0c
	{0.000,			76.373,			{0.0000000E+00,	 	1.7057035E+01,		-2.3301759E-01,		6.5435585E-03,		-7.3562749E-05,		-1.7896001E-06,	 	8.4036165E-08, 		-1.3735879E-09,	 	1.0629823E-11, 		-3.2447087E-14}}	//TC_CURVE_E2, 0c - 1000c
};

const TCCOEF_TYPEDEF TCJ_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
	//type j
	{-8.095,		0.000,			{0.0000000E+00,		1.9528268E+01,		-1.2286185E+00,		-1.0752178E+00,		-5.9086933E-01,		-1.7256713E-01,		-2.8131513E-02,		-2.3963370E-03,		-8.3823321E-05,		0.00}},				//TC_CURVE_J1, -210c - 0c
	{0.000,			42.919,			{0.000000E+00,		1.978425E+01,		-2.001204E-01,		1.036969E-02,		-2.549687E-04,		 3.585153E-06,		-5.344285E-08,		5.099890E-10,		0.000000E+00,		0.00}},				//TC_CURVE_J2, 0 - 760c
	{42.919,		69.553,			{-3.11358187E+03,	3.00543684E+02,		-9.94773230E+00,	1.70276630E-01,		-1.43033468E-03,	4.73886084E-06,		0.00000000E+00,		0.00000000E+00,		0.00000000E+00,		0.00}}				//TC_CURVE_J3, 760c - 1200c
};

const TCCOEF_TYPEDEF TCK_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
	//type k
	{-5.891,		0.000,			{0.0000000E+00,		2.5173462E+01,		-1.1662878E+00,		-1.0833638E+00,		-8.9773540E-01,		-3.7342377E-01,		-8.6632643E-02,		-1.0450598E-02,		-5.1920577E-04,		0.0000000E+00}},	//TC_CURVE_K1, -200 - 0c
	{0.000,			20.644,			{0.000000E+00,		2.508355E+01,		7.860106E-02,		-2.503131E-01,		8.315270E-02,		-1.228034E-02,		9.804036E-04,		-4.413030E-05,		1.057734E-06,		-1.052755E-08}},	//TC_CURVE_K2, 0 - 500c
	{20.644,		54.886,			{-1.318058E+02,		4.830222E+01,		-1.646031E+00,		5.464731E-02,		-9.650715E-04,		8.802193E-06,		-3.110810E-08,		0.000000E+00,		0.000000E+00,		0.000000E+00}}		//TC_CURVE_K3, 500 - 1372c
};

const TCCOEF_TYPEDEF TCN_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
	//type n
	{-3.990,		0.00,			{0.0000000E+00,		3.8436847E+01,		1.1010485E+00,		5.2229312E+00,		7.2060525E+00,		5.8488586E+00,		2.7754916E+00,		7.7075166E-01,		1.1582665E-01,		7.3138868E-03}},	//TC_TYPE_N1, -200 - 0c
	{0.00,			20.613,			{0.00000E+00,		 3.86896E+01,		-1.08267E+00,		4.70205E-02,		-2.12169E-06,		-1.17272E-04,		5.39280E-06,		-7.98156E-08,		0.00000E+00,		0.00000E+00}},		//TC_TYPE_N2, 0 - 600c
	{20.613,		47.513,			{1.972485E+01,		3.300943E+01,		-3.915159E-01,		9.855391E-03,		-1.274371E-04,		7.767022E-07,		0.000000E+00,		0.000000E+00,		0.000000E+00,		0.000000E+00}}		//TC_TYPE_N3, 600 - 1300c
};

const TCCOEF_TYPEDEF TCR_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
	//type r
	{-0.226,		1.923,			{0.0000000E+00,		1.8891380E+02,		-9.3835290E+01,		1.3068619E+02,		-2.2703580E+02,		3.5145659E+02,		-3.8953900E+02,		2.8239471E+02,		-1.2607281E+02,		3.1353611E+01/*,	-3.3187769E+00*/}},	//TC_TYPE_R1, -50 - 250c
	{1.923,			13.228,			{1.334584505E+01,	1.472644573E+02,	-1.844024844E+01,	4.031129726E+00,	-6.249428360E-01,	6.468412046E-02,	-4.458750426E-03,	1.994710149E-04,	-5.313401790E-06,	6.481976217E-08/*,	0.000000000E+00*/}},	//TC_TYPE_R2, 250 - 1200c
	{13.228,		19.739,			{-8.199599416E+01,	1.553962042E+02,	-8.342197663E+00,	4.279433549E-01,	-1.191577910E-02,	1.492290091E-04,	0.000000000E+00,	0.000000000E+00,	0.000000000E+00,	0.000000000E+00}},	//TC_TYPE_R3, 1064 - 1664c
	{19.739,		21.103,			{3.406177836E+04,	-7.023729171E+03,	5.582903813E+02,	-1.952394635E+01,	2.560740231E-01,	0.000000000E+00,	0.000000000E+00,	0.000000000E+00,	0.000000000E+00,	0.000000000E+00}}	//TC_TYPE_R4, 1664 - 1768c
};

const TCCOEF_TYPEDEF TCS_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
	//type s
	{-0.236,		1.874,			{0.00000000E+00,	1.84949460E+02,		-8.00504062E+01,	1.02237430E+02,		-1.52248592E+02,	1.88821343E+02,		-1.59085941E+02,	8.23027880E+01,		-2.34181944E+01,	2.79786260E+00}},	//TC_TYPE_R1, -50 - 250c
	{1.874,			11.950,			{1.291507177E+01,	1.466298863E+02,	-1.534713402E+01,	3.145945973E+00,	-4.163257839E-01,	3.187963771E-02,	-1.291637500E-03,	2.183475087E-05,	-1.447379511E-07,	8.211272125E-09}},	//TC_TYPE_R2, 250 - 1200c
	{11.950,		17.536,			{-8.087801117E+01,	1.621573104E+02,	-8.536869453E+00,	4.719686976E-01,	-1.441693666E-02,	2.081618890E-04,	0.000000000E+00,	0.000000000E+00,	0.000000000E+00,	0.000000000E+00}},	//TC_TYPE_R3, 1064 - 1664c
	{17.536,		18.693,			{5.333875126E+04,	-1.235892298E+04,	1.092657613E+03,	-4.265693686E+01,	6.247205420E-01,	0.000000000E+00,	0.000000000E+00,	0.000000000E+00,	0.000000000E+00,	0.000000000E+00}}	//TC_TYPE_R4, 1664 - 1768c
};

const TCCOEF_TYPEDEF TCT_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
	//type t
	{-5.603,		0.000,			{0.0000000E+00,		2.5949192E+01,		-2.1316967E-01,		7.9018692E-01,		4.2527777E-01,		1.3304473E-01,		2.0241446E-02,		1.2668171E-03,		0.0000000E+00,		0.0000000E+00}},	//TC_TYPE_R1, -200 - 0c
	{0.000,			20.872,			{0.000000E+00,		2.592800E+01,		-7.602961E-01,		4.637791E-02,		-2.165394E-03,		6.048144E-05,		-7.293422E-07,		0.000000000E+00,	0.000000000E+00,	0.000000000E+00}}	//TC_TYPE_R4, 0 - 400c
};

//5th order approximation
/*						//K       	//J       	//R       	//S      	//B      	//E     	//T      	//N     	//Pt100     	//cu50,   	//B<600
float code TC_Atab[11]={-7.5997e-7,	9.6322e-8,	4.8472e-4,	7.3225e-4,	2.4515e-3,	1.3651e-7,	9.9154e-5,	2.8055e-6,	-1.2878e-11,	-1.0896e-9,	205.65};
float code TC_Btab[11]={1.0905e-4,	8.7504e-6,	-2.8158e-2,	-3.6447e-2,	-0.11385,	-3.3295e-5,	-4.9932e-3,	-4.1148e-4,	1.5932e-8,		3.2617e-7,	-1037.8};
float code TC_Ctab[11]={-3.9325e-3,	2.0766e-3,	0.65866,	0.73075,	2.2226,		3.3864e-3,	9.3174e-2,	2.4892e-2,	-6.1794e-6,		-6.751e-5,	1970.3};
float code TC_Dtab[11]={0.017394,	0.062995,	-8.4431,	-8.1816,	-23.776,	-0.17164,	-0.98715,	-0.76438,	2.1231e-3,		7.6826e-3,	-1796};
float code TC_Etab[11]={24.75,		17.726,		136.69,		140.41,		228.37,		16.637,		25.774,		37.309,		2.2614,			4.2719,		1047};
float code TC_Ftab[11]={-0.55944,	3.457,		11.693,		9.6808,		256.77,		0.6252,		1.3639,		1.2499,		-242.75,		-226.06,	60.546};
//由于B型热电偶函数特殊，非线性很大，拟合分为了两段，小于600摄氏度一段，大于600摄氏度一段
*/

const TCCOEF5_TYPEDEF TCB5_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
	//type b
    {0.291, 		13.820, 		{1.93559957E+02,	2.87194132E+02,		-4.24257073E+01,	4.84404652E+00,  	-2.82072795E-01, 	6.47250272E-03}}   //TC_CURVE_B1, Type B, 250 - 600c
};

const TCCOEF5_TYPEDEF TCE5_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
	//type t
    {-8.825,		76.373,			{-1.46669073E+00,	1.77972063E+01,		-2.80592192E-01,	7.13139023E-03,		-8.72161697E-05,	4.12527224E-07}}	//TC_CURVE_E
};
//type j not accurate
const TCCOEF5_TYPEDEF TCJ5_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
	//type J
    {-8.095,		69.553,			{-2.92300096E+00,	2.06555388E+01,		-2.20102636E-01,	8.30102173E-03,		-1.52553786E-04,	9.92407667E-07}}	//TC_CURVE_J
};

const TCCOEF5_TYPEDEF TCK5_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
	//type K
    {-5.891,		54.886,			{-3.75385386E+00,	2.72607737E+01,		-3.12104867E-01,	1.18834505E-02,		-2.08857064E-04,	1.51070281E-06}}	//TC_CURVE_K
};

const TCCOEF5_TYPEDEF TCN5_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
	//type N
    {-3.990,		47.513,			{-3.25708877E+00,	3.91627713E+01,		-9.44218539E-01,	3.14183380E-02,		-5.05207719E-04,	3.21317418E-06}}	//TC_CURVE_N
};

const TCCOEF5_TYPEDEF TCR5_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
	//type R
    {-0.226,		21.103,			{7.31622696E+00,	1.39896383E+02,		-9.17768998E+00,	7.31122709E-01,		-3.13818823E-02,	5.37868361E-04}}	//TC_CURVE_R
};

const TCCOEF5_TYPEDEF TCS5_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
	//type S
    {-0.236,		18.693,			{5.42026883E+00,	1.44112870E+02,		-9.18078825E+00,	8.45662979E-01,		-4.24009775E-02,	8.46439766E-04}}	//TC_CURVE_S
};

const TCCOEF5_TYPEDEF TCT5_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
	//type t
    {-5.603,		20.872,			{1.09834034E+00,	2.61072492E+01,		-9.80093485E-01,	7.81165380E-02,		-3.53846135E-03,	6.09839986E-05}}	//TC_CURVE_T
};

const TCCOEF5_TYPEDEF PT100_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
	//type PT100 - mV_HIGH/mV_LOW have no meaning here
    {-8.825,		76.373,			{-242.75,			2.2614,				2.1231e-3,			-6.1794e-6,			1.5932e-8,			-1.2878e-11}}		//PT100, 6TH ORDER
};

const TCCOEF5_TYPEDEF CU50_table[] = {
	//mV_LOW,		//mV_HIGH,		//d_0				//d_1				//d_2				//d_3				//d_4				//d_5				//d_6				//d_7				//d_8				//d_9
	//type CU50 - mV_HIGH/mV_LOW have no meaning here
    {-8.825,		76.373,			{-226.06,			4.2719,				7.6826e-3,			-6.751e-5,			3.2617e-7,			-1.0896e-9}}			//TC_CURVE_T
};


//thermocouple B/E/J/K/N/R/S/T: calculate temperature from mv
//double TC_mv2c(const TCCOEF_TYPEDEF *tc_curve, unsigned char order, double mv) {
double TC_mv2c(const double *coef, unsigned char order, double mv) {
	double tmp;					//temporary variable holding the intermediate results
#if 0
	double mv_i;				//mv^i
	unsigned char i;			//loop index
	mv_i = mv;
	tmp=*coef++;				//d_0
	for (i=1; i<=order; i++) {	//go through the loop
		tmp += (*coef++)*mv_i;	//calcualte d_i, i=1..order
		mv_i *= mv;				//mv_i = mv ^ i;
	}
#else
	//horner's method
	tmp = coef[order];			//pick up the highest order
	while (order--) {
		tmp *= mv;				//times the highest order
		tmp += coef[order];		//pick up the next highest order
	}
#endif
	return tmp;
}

